<!DOCTYPE html>
<html>
<head>
  <title>Auth Debug</title>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js'
    import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js'

    // Never commit real credentials in this file.
    // Paste your project values here locally when needed.
    const firebaseConfig = {
      apiKey: "REPLACE_ME",
      authDomain: "REPLACE_ME",
      projectId: "REPLACE_ME",
      appId: "REPLACE_ME"
    }

    const hasPlaceholder = Object.values(firebaseConfig).some((value) => value === 'REPLACE_ME')
    if (hasPlaceholder) {
      const output = document.getElementById('output')
      output.innerHTML = `
        <h2 style="color: #b45309">‚ö†Ô∏è Configure firebaseConfig first</h2>
        <p>Edit <code>scripts/check-auth.html</code> locally and set real values before using this debugger.</p>
      `
      throw new Error('Firebase config placeholders detected')
    }

    const app = initializeApp(firebaseConfig)
    const auth = getAuth(app)

    onAuthStateChanged(auth, async (user) => {
      const output = document.getElementById('output')

      if (user) {
        const token = await user.getIdTokenResult()

        output.innerHTML = `
          <h2 style="color: green">‚úÖ Authenticated</h2>
          <pre style="background: #f5f5f5; padding: 20px; border-radius: 8px;">
<strong>User Info:</strong>
UID:   ${user.uid}
Email: ${user.email}
Email (lowercase): ${user.email?.toLowerCase()}

<strong>Expected Admin Email:</strong>
creeed22@gmail.com

<strong>Match?</strong> ${user.email?.toLowerCase() === 'creeed22@gmail.com' ? '‚úÖ YES' : '‚ùå NO'}

<strong>Token Claims:</strong>
${JSON.stringify(token.claims, null, 2)}

<strong>Auth Provider:</strong>
${user.providerData.map(p => p.providerId).join(', ')}
          </pre>
        `
      } else {
        output.innerHTML = `
          <h2 style="color: red">‚ùå Not Authenticated</h2>
          <p>Please sign in on the main app first, then refresh this page.</p>
        `
      }
    })
  </script>
</head>
<body style="font-family: system-ui; padding: 40px; max-width: 800px; margin: 0 auto;">
  <h1>üîç Auth Debugger</h1>
  <div id="output">
    <p>Loading...</p>
  </div>
</body>
</html>
